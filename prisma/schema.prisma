generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
}

enum Role {
    user
    admin
}

enum PropertyType {
    house
    apartment
    condo
    townhouse
    land
    commercial
}

enum PropertyStatus {
    available
    pending
    sold
}

enum InquiryStatus {
    new
    contacted
    closed
}

enum ViewingStatus {
    scheduled
    confirmed
    completed
    cancelled
}

model User {
    id           Int      @id @default(autoincrement())
    openId       String   @unique @db.VarChar(64)
    name         String?  @db.Text
    email        String?  @db.VarChar(320)
    loginMethod  String?  @db.VarChar(64)
    role         Role     @default(user)
    createdAt    DateTime @default(now())
    updatedAt    DateTime @updatedAt
    lastSignedIn DateTime @default(now())

    favorites     Favorite[]
    comparisons   Comparison[]
    savedSearches SavedSearch[]
    inquiries     Inquiry[]
    viewings      PropertyViewing[]
}

model Property {
    id           Int            @id @default(autoincrement())
    title        String         @db.VarChar(255)
    description  String?        @db.Text
    price        Decimal        @db.Decimal(12, 2)
    propertyType PropertyType
    bedrooms     Int
    bathrooms    Int
    squareFeet   Int?
    address      String         @db.VarChar(255)
    city         String         @db.VarChar(100)
    state        String         @db.VarChar(100)
    zipCode      String         @db.VarChar(20)
    latitude     Decimal?       @db.Decimal(10, 8)
    longitude    Decimal?       @db.Decimal(11, 8)
    amenities    Json?
    featured     Boolean        @default(false)
    status       PropertyStatus @default(available)
    createdAt    DateTime       @default(now())
    updatedAt    DateTime       @updatedAt

    images    PropertyImage[]
    favorites Favorite[]
    inquiries Inquiry[]
    viewings  PropertyViewing[]
}

model PropertyImage {
    id           Int      @id @default(autoincrement())
    propertyId   Int
    imageUrl     String   @db.Text
    caption      String?  @db.VarChar(255)
    displayOrder Int      @default(0)
    createdAt    DateTime @default(now())

    property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

    @@index([propertyId])
}

model Favorite {
    id         Int      @id @default(autoincrement())
    userId     Int
    propertyId Int
    createdAt  DateTime @default(now())

    user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
    property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

    @@index([userId])
    @@index([propertyId])
}

model Inquiry {
    id         Int           @id @default(autoincrement())
    propertyId Int
    userId     Int?
    name       String        @db.VarChar(255)
    email      String        @db.VarChar(320)
    phone      String?       @db.VarChar(20)
    message    String?       @db.Text
    status     InquiryStatus @default(new)
    createdAt  DateTime      @default(now())
    updatedAt  DateTime      @updatedAt

    property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
    user     User?    @relation(fields: [userId], references: [id], onDelete: SetNull)

    @@index([propertyId])
    @@index([userId])
}

model Comparison {
    id          Int      @id @default(autoincrement())
    userId      Int
    propertyIds Json
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@index([userId])
}

model SavedSearch {
    id           Int      @id @default(autoincrement())
    userId       Int
    name         String   @db.VarChar(255)
    minPrice     Decimal? @db.Decimal(12, 2)
    maxPrice     Decimal? @db.Decimal(12, 2)
    bedrooms     Int?
    bathrooms    Int?
    propertyType String?  @db.VarChar(50)
    amenities    Json?
    createdAt    DateTime @default(now())
    updatedAt    DateTime @updatedAt

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@index([userId])
}

model PropertyViewing {
    id           Int           @id @default(autoincrement())
    propertyId   Int
    userId       Int?
    visitorName  String        @db.VarChar(255)
    visitorEmail String        @db.VarChar(320)
    visitorPhone String?       @db.VarChar(20)
    viewingDate  DateTime
    viewingTime  String        @db.VarChar(10)
    duration     Int           @default(30)
    notes        String?       @db.Text
    status       ViewingStatus @default(scheduled)
    reminderSent Boolean       @default(false)
    createdAt    DateTime      @default(now())
    updatedAt    DateTime      @updatedAt

    property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
    user     User?    @relation(fields: [userId], references: [id], onDelete: SetNull)

    @@index([propertyId])
    @@index([userId])
}

model ContactMessage {
    id        Int      @id @default(autoincrement())
    name      String   @db.VarChar(255)
    email     String   @db.VarChar(320)
    subject   String   @db.VarChar(255)
    message   String   @db.Text
    createdAt DateTime @default(now())

    @@index([email])
}
